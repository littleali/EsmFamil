<div class="jumbotron" id="hp-main-jumbotron">
  <div class="container">
    <div class="row">
      <div class="well " id="room-well">
        <div class="row">
          <div class="col-md-2">
            <% if current_user.id == @room.admin.user.id %>
                <%= button_to 'حذف اتاق', @room, method: :delete, data: {confirm: 'مطمئن هستید؟'}, :class => "btn btn-default room-edit-btn" %>
            <% end %>
          </div>

          <div class="col-md-2">
            اتاق فعال
            <% if @room.enabled? %>
                است
            <% else %>
                نیست
            <% end %>
          </div>
          <div class="col-md-3">
            ظرفیت اتاق: <%= @room.capacity %> نفر
          </div>
          <div class="col-md-3">
            مدیر اتاق: <%= @room.admin.user.username %>
          </div>
          <div class="col-md-2">
            نام اتاق: <%= @room.name %>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4">
        <div class="panel panel-info">
          <div class="panel-heading">سابقه‌ی بازی‌های اتاق</div>
          <div class="panel-body"></div>
        </div>

      </div>
      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading">گفت‌وگوها</div>
          <div class="panel-body"></div>
        </div>
        <div class="col-md-4"></div>
        <div class="col-md-4">
          <%= button_to 'لیست اتاق‌ها', rooms_path, method: :get, :class => "btn btn-success" %>
        </div>
        <div class="col-md-4"></div>
      </div>
      <div class="col-md-4">
        <div class="panel panel-primary">
          <div class="panel-heading">لیست اعضای اتاق (<%= @room.players.size %> نفر)</div>
          <div class="panel-body">
            <% if @room.players.size > 0 %>
                <table class="table table-hover table-striped">
                  <tbody id="room_tbody_<%=@room.id%>">
                  <% @room.players.each do |player| %>
                        <%= render :partial => 'rooms/member', :locals => {:room => @room, :player => player} %>
                  <% end %>
                  </tbody>
                </table>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



<%= link_to 'Edit', edit_room_path(@room) %> |
<%= link_to 'Back', rooms_path %>
<%= link_to 'Destroy', @room, method: :delete, data: {confirm: 'Are you sure?'} %>

<%= %>
<!--link_to 'Add to this room', {:controller => :rooms, :action => :add_member, :room_id => @room.id.to_s, :profile_id => current_user.profile.id.to_s, :method => :patch} %>-->
<%= link_to 'Add to this room', "/rooms/#{@room.id}/add_member/#{current_user.profile.id}", :method => :patch, :remote => true %>

<script type="text/javascript">

    window.client.subscribe('/rooms/<%=@room.id%>', function (payload) {
        if (payload.action == 'kick'){
            var element = $('#tr_'+payload.player_id);
            element.remove();
        }

        else
            $("#room_tbody_<%=@room.id%>").append(" <tr id='tr_" + payload.player_id + "'>" +
                "<td>" + payload.player_username + "</td>" +
        "<td>" + "<a class='kick-out-link' confirm='آیا مطمئن هستید?' data-remote='true' data-method='delete' href='/rooms/<%=@room.id%>/kick_out/" + payload.player_id +  "' rel='nofollow'>حذف کاربر</a>" + "</td><tr>");
    });
</script>
