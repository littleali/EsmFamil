<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<%= javascript_include_tag "jquery.plugin" %>
<%= javascript_include_tag "jquery.countdown" %>
<%= javascript_include_tag "jquery.countdown-fa" %>
<div class="jumbotron" id = "hp-main-jumbotron">
	<div class="container">
    <div class="row">
      <div class="well " id ="room-well">
        <div class= "row">
          <div class="col-md-2">
            <% if current_user.id == @room.admin.user.id %>
            <%= button_to 'حذف اتاق', @room, method: :delete, data: { confirm: 'مطمئن هستید؟' } , :class=>"btn btn-default room-edit-btn"%>
            <%end%>
          </div>
  
          <div class="col-md-2">
            اتاق فعال
            <%if @room.enabled? %>
              است
            <% else %>
              نیست
            <%end%>
          </div>
          <div class="col-md-3">
            ظرفیت اتاق: <%= @room.capacity %> نفر
          </div>
          <div class="col-md-3">
            مدیر اتاق: <%= @room.admin.user.username %>
          </div>
          <div class="col-md-2">
            نام اتاق: <%= @room.name %>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4">
        <div class="panel panel-info">
          <div class="panel-heading">سابقه‌ی بازی‌های اتاق</div>
          <div class="panel-body">
            <table class="table table-hover table-striped">
              <% @room.games.each do |game| %>

              <tr>
                <td> <%= game.title%></td>
                <td> 
                  <% if game.start_time %>
                    <% if game.start_time < DateTime.now %>
                      <script>
                        $(function () {
                          var finishTime = new Date();
                          var v = new Date();
                          finishTime.setMinutes(v.getMinutes()+1);
                          // finishTime = finishTime + (finishTime.getSeconds() + 50)
                          $('#afterStartCountDown').countdown({until: finishTime, 
                          format: 'S', description: 'پایان بازی'});
                        });
                      </script>
                      <div id="afterStartCountDown"></div>
                    <% else %>
                      <script>
                        $(function () {
                          var finishTime = <%= game.start_time %>;
                          var v = new Date();
                          finishTime.setMinutes(v.getMinutes()+1);
                          // finishTime = finishTime + (finishTime.getSeconds() + 50)
                          $('#beforeStartCountDown').countdown({until: finishTime, 
                          format: 'S', description: 'شروع بازی'});
                        });
                      </script>
                      <div id="beforeStartCountDown"></div>      
                    <% end %>

                  <% else%>
                    <%= 'شروع نشده' %>
                  <% end %>
                </td>
              </tr>

              <%end%>
            </table>

            <br>
              <%= link_to 'ایجاد بازی' , "/gamerooms/#{@room.name}/game/new",:method => :get,:class=>"btn btn-success"%>
            <br>
          </div>
        </div>

      </div>
      <div class="col-md-4">
        <div class="panel panel-default">
          <div class="panel-heading">گفت‌وگوها</div>
          <div class="panel-body"></div>
        </div>
        <div class="col-md-4"></div>
        <div class="col-md-4">
         <%= button_to 'لیست اتاق‌ها', rooms_path, method: :get, :class=>"btn btn-success"%>
         </div>
         <div class="col-md-4"></div>
      </div>
      <div class="col-md-4">
        <div class="panel panel-primary">
  				<div class="panel-heading">لیست اعضای اتاق (<%= @room.players.size%> نفر)</div>
          <div class="panel-body"> <% if @room.players.size > 0 %>
				  <table class="table table-hover table-striped">
            <tbody>
						  <% @room.players.each do |player| %>
							<tr>
                <td><%=player.user.username%></td><td><%= link_to 'حذف کاربر', "/rooms/#{@room.id}/kick_out/#{player.id}",
            :confirm => 'آیا مطمئن هستید?', :method => :delete , :class => "kick-out-link"%></td>
              </tr>
						  <% end %>
            </tbody>
				  </table>
          <% end %>
          

        </div>
        </div>
      </div>
    </div>
  </div>
</div>
     


<%= link_to 'Edit', edit_room_path(@room) %> |
<%= link_to 'Back', rooms_path %>
<%= link_to 'Destroy', @room, method: :delete, data: { confirm: 'Are you sure?' } %>




